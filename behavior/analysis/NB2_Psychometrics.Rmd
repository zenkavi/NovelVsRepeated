---
title: "Novel vs. repeated choice project: Psychometrics"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: 'hide'
---

# Set up environment and load in data

```{r include=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
helpers_path = paste0(here(),'/analysis/helpers/')
source(paste0(helpers_path, '01_clean_behavioral_data.R'))
fig_out_path = paste0(here(), '/outputs/fig/')
```

Add columns that will be used for plots below.

```{r}
data_yn_clean = data_yn_clean %>%
  mutate(correct = ifelse(possiblePayoff>reference & yesChosen == 1, 1, ifelse(possiblePayoff < reference & yesChosen == 0, 1, 0))) %>%
  mutate(type = ifelse(type == 1, "HT", "RE"),
         week = ifelse(week == 1, "Week 1", ifelse(week == 2, "Week 2", ifelse(week == 3, "Week 3", NA))),
         week = factor(week, levels = c("Week 1", "Week 2", "Week 3"))) %>%
  mutate(val_diff = possiblePayoff - reference,
         val_diff_bin = round(val_diff/50),
         val_diff_bin_str = ifelse(val_diff_bin == 0, "-50:50", 
                                   ifelse(val_diff_bin == 1, "50:100",
                                          ifelse(val_diff_bin == -1, "-100:-50",
                                                 ifelse(val_diff_bin == 2, "100:150",
                                                        ifelse(val_diff_bin == -2, "-150:-100",
                                                               ifelse(val_diff_bin == 3, "150:200",
                                                                      ifelse(val_diff_bin == -3, "-200:-150",
                                                                             ifelse(val_diff_bin == 4, "200:250", 
                                                                                    ifelse(val_diff_bin == -4, "-250:-200", NA))))))))),
         val_diff_bin_str = factor(val_diff_bin_str, levels = c("-250:-200", "-200:-150", "-150:-100", "-100:-50", "-50:50", "50:100", "100:150", "150:200", "200:250")))

data_bc_clean = data_bc_clean %>%
  mutate(correct = ifelse(possiblePayoffleft>possiblePayoffright & leftChosen == 1, 1, ifelse(possiblePayoffleft<possiblePayoffright & leftChosen == 0, 1, 0))) %>%
  mutate(type = ifelse(typeLeft == 1, "HT", "RE"),
         week = ifelse(week == 1, "Week 1", ifelse(week == 2, "Week 2", ifelse(week == 3, "Week 3", NA))),
         week = factor(week, levels = c("Week 1", "Week 2", "Week 3"))) %>%
  mutate(val_diff = possiblePayoffleft - possiblePayoffright,
         val_diff_bin = round(val_diff/50),
         val_diff_bin_str = ifelse(val_diff_bin == 0, "-50:50", 
                                   ifelse(val_diff_bin == 1, "50:100",
                                          ifelse(val_diff_bin == -1, "-100:-50",
                                                 ifelse(val_diff_bin == 2, "100:150",
                                                        ifelse(val_diff_bin == -2, "-150:-100",
                                                               ifelse(val_diff_bin == 3, "150:200",
                                                                      ifelse(val_diff_bin == -3, "-200:-150",
                                                                             ifelse(val_diff_bin == 4, "200:250", 
                                                                                    ifelse(val_diff_bin == -4, "-250:-200", 
                                                                                           ifelse(val_diff_bin == 5, "250:300",
                                                                                                  ifelse(val_diff_bin == -5, "-300:-250", NA))))))))))),
         val_diff_bin_str = factor(val_diff_bin_str, levels = c("-300:-250", "-250:-200", "-200:-150", "-150:-100", "-100:-50", "-50:50", "50:100", "100:150", "150:200", "200:250", "250:300")))
```

# Accuracy over days

## YN Task

```{r}
p = data_yn_clean %>%
  group_by(subnum, day, type) %>%
  summarise(mean_correct = mean(correct),
            sem_correct = sd(correct)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(day, mean_correct, color=type))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_correct-sem_correct, ymax=mean_correct+sem_correct), width=0)+
  geom_line()+
  facet_wrap(~subnum)+
  labs(x = "Day", y = "Accuracy", title="Y/N Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        legend.box.margin=margin(t = -10))+
  scale_x_continuous(breaks=seq(1,11,1))+
  scale_color_brewer(palette = "Dark2")
p
ggsave(file=paste0(fig_out_path, 'yn_accuracyOverDays.jpg'), p, height = 5, width=8, units="in")
```

## BC Task

```{r}
p = data_bc_clean %>%
  group_by(subnum, day, type) %>%
  summarise(mean_correct = mean(correct),
            sem_correct = sd(correct)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(day, mean_correct, color=type))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_correct-sem_correct, ymax=mean_correct+sem_correct), width=0)+
  geom_line()+
  facet_wrap(~subnum)+
  labs(x = "Day", y = "Accuracy", title="BC Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        legend.box.margin=margin(t = -10))+
  scale_x_continuous(breaks=seq(1,11,1))+
  scale_color_brewer(palette = "Dark2")

p
ggsave(file=paste0(fig_out_path, 'bc_accuracyOverDays.jpg'), p, height = 5, width=8, units="in")
```

# Accuracy depending on value difference

## YN Task

```{r}
p = data_yn_clean %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_correct = mean(correct),
            sem_correct = sd(correct)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_correct, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_correct-sem_correct, ymax=mean_correct+sem_correct), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  labs(x = "Value Stim - Value Reference", y = "Accuracy", title="Y/N Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250"))+
  scale_y_continuous(breaks = seq(.6,1,.2))

p
ggsave(file=paste0(fig_out_path, 'yn_accuracyByValDiff.jpg'), p, height = 7, width=8, units="in")
```

## BC Task

```{r}
p = data_bc_clean %>%
  filter(abs(val_diff_bin) != 6) %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_correct = mean(correct),
            sem_correct = sd(correct)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_correct, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_correct-sem_correct, ymax=mean_correct+sem_correct), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  labs(x = "Value Left - Value Right", y = "Accuracy", title="BC Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(.25,1,.25))

p
ggsave(file=paste0(fig_out_path, 'bc_accuracyByValDiff.jpg'), p, height = 7, width=8, units="in")

```

# Yes/Left depending on value difference

## YN Task

```{r}
p = data_yn_clean %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_yes = mean(yesChosen),
            sem_yes = sd(yesChosen)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_yes, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_yes-sem_yes, ymax=mean_yes+sem_yes), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=5), color="gray", linetype = "longdash")+
  labs(x = "Value Stim - Value Reference", y = "p(Yes)", title="Y/N Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250"))+
  scale_y_continuous(breaks = seq(0,1,.5))

p
ggsave(file=paste0(fig_out_path, 'yn_pYesByValDiff.jpg'), p, height = 7, width=8, units="in")
```

```{r}
p = data_yn_clean %>%
  filter(fmri==1) %>%
  group_by(subnum, day, val_diff_bin_str, type) %>%
  summarise(mean_yes = mean(yesChosen),
            sem_yes = sd(yesChosen)/sqrt(n()),
            .groups="keep") %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels  = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_yes, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_yes-sem_yes, ymax=mean_yes+sem_yes), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~day)+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=5), color="gray", linetype = "longdash")+
  labs(x = "Value Stim - Value Reference", y = "p(Yes)", title="Y/N Task (fMRI sessions)", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250"))+
  scale_y_continuous(breaks = seq(0,1,.5))

p
ggsave(file=paste0(fig_out_path, 'yn_pYesByValDiffMRI.jpg'), p, height = 7, width=8, units="in")
```

## BC Task

```{r}
p = data_bc_clean %>%
  filter(abs(val_diff_bin) != 6) %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_left = mean(leftChosen),
            sem_left = sd(leftChosen)/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_left, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_left-sem_left, ymax=mean_left+sem_left), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  labs(x = "Value Left - Value Right", y = "p(Left)", title="BC Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

p
ggsave(file=paste0(fig_out_path, 'bc_pLeftByValDiff.jpg'), p, height = 7, width=8, units="in")
```

```{r}
p = data_bc_clean %>%
  filter(abs(val_diff_bin) != 6) %>%
  filter(fmri==1) %>%
  group_by(subnum, day, val_diff_bin_str, type) %>%
  summarise(mean_left = mean(leftChosen),
            sem_left = sd(leftChosen)/sqrt(n()),
            .groups="keep") %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels  = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_left-sem_left, ymax=mean_left+sem_left), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~day)+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  labs(x = "Value Left - Value Right", y = "p(Left)", title="BC Task (fMRI sessions)", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

p
ggsave(file=paste0(fig_out_path, 'bc_pLeftByValDiffMRI.jpg'), p, height = 7, width=8, units="in")
```

# RT over days

## YN Task

```{r}
p = data_yn_clean %>%
  group_by(subnum, day, type) %>%
  summarise(mean_log_rt = mean(log(rt)),
            sem_log_rt = sd(log(rt))/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(day, mean_log_rt, color=type))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_log_rt-sem_log_rt, ymax=mean_log_rt+sem_log_rt), width=0)+
  geom_line()+
  facet_wrap(~subnum)+
  labs(x = "Day", y = "Mean Log RT", title="Y/N Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        legend.box.margin=margin(t = -10))+
  scale_x_continuous(breaks=seq(1,11,1))+
  scale_color_brewer(palette = "Dark2")

p
ggsave(file=paste0(fig_out_path, 'yn_RTOverDays.jpg'), p, height = 5, width=8, units="in")
```

## BC Task

```{r}
p = data_bc_clean %>%
  group_by(subnum, day, type) %>%
  summarise(mean_log_rt = mean(log(rt)),
            sem_log_rt = sd(log(rt))/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(day, mean_log_rt, color=type))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_log_rt-sem_log_rt, ymax=mean_log_rt+sem_log_rt), width=0)+
  geom_line()+
  facet_wrap(~subnum)+
  labs(x = "Day", y = "Mean Log RT", title="BC Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        legend.box.margin=margin(t = -10))+
  scale_x_continuous(breaks=seq(1,11,1))+
  scale_color_brewer(palette = "Dark2")

p
ggsave(file=paste0(fig_out_path, 'bc_RTOverDays.jpg'), p, height = 5, width=8, units="in")
```

# RT depending on value difference

## YN Task

```{r}
p = data_yn_clean %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_log_rt = mean(log(rt)),
            sem_log_rt = sd(log(rt))/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_log_rt, color=type))+
  # geom_point()+
  geom_jitter(width=.2)+
  geom_errorbar(aes(ymin=mean_log_rt-sem_log_rt, ymax=mean_log_rt+sem_log_rt), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  labs(x = "Value Stim - Value Reference", y = "Mean Log RT", title="Y/N Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250"))+
  scale_y_continuous(breaks = seq(-1,.5,.5))

p
ggsave(file=paste0(fig_out_path, 'yn_RTOverValDiff.jpg'), p, height = 5, width=8, units="in")
```

## BC Task

```{r}
p = data_bc_clean %>%
  filter(abs(val_diff_bin) != 6) %>%
  group_by(subnum, week, val_diff_bin_str, type) %>%
  summarise(mean_log_rt = mean(log(rt)),
            sem_log_rt = sd(log(rt))/sqrt(n()),
            .groups="keep") %>%
  ggplot(aes(val_diff_bin_str, mean_log_rt, color=type))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_log_rt-sem_log_rt, ymax=mean_log_rt+sem_log_rt), width=0)+
  geom_line(aes(group=type))+
  facet_grid(subnum~week)+
  labs(x = "Value Left - Value Right", y = "Accuracy", title="BC Task", color="")+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(-1,.5,.5))

p
ggsave(file=paste0(fig_out_path, 'bc_RTOverValDiff.jpg'), p, height = 5, width=8, units="in")
```

# Fixation Cross Free RT

What does the distribution of free RTs during the fixation look like?

## YN Task

For task_beah (non-fmri sessions) `startFix` is when the fixation comes on

```{r}
yn_fix_rt_data = data_yn_clean %>%
  filter(fmri == 0) %>%
  select(-evtimeON, -evtimeOFF, -fmri, -response, -valueO, -valueF, -valueS, -stimNum, -crossON) %>%
  group_by(subnum, day, session) %>%
  mutate(trialNum = 1:n(),
         startFixDiff = c(diff(startFix), NA), 
         rewardTime = ifelse(session == 1 & trialNum < 16, 2.4, ifelse(session == 1 & trialNum > 15 & trialNum < 36, 1.5, 1))) %>%
  filter(!is.na(startFixDiff)) %>%
  mutate(fixRt = startFixDiff - (rt+rewardTime))
```

There are some very long RTs during the fixation cross

```{r}
summary(yn_fix_rt_data$fixRt)
```

But less than 2% of all trials have fixations RTs slower than 1 second.

```{r}
sum(yn_fix_rt_data$fixRt>1)/nrow(yn_fix_rt_data)
```

Excluding slow fixation RTs for the plot

```{r}
yn_fix_rt_data %>%
  filter(fixRt < 1) %>%
  ggplot(aes(fixRt))+
  geom_histogram(alpha=.5, bins=30)+
  facet_wrap(~subnum)+
  theme(panel.grid = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())+
  labs(y="", x = "Fixation Cross RT", title = "Y/N Task")

```

```{r}
yn_fix_rt_data %>%
  filter(fixRt < 1) %>%
  ungroup() %>%
  group_by(subnum, day) %>%
  summarise(.groups="keep",
            mean_log_fix_rt = mean(log(fixRt)),
            sem_log_fix_rt = sd(log(fixRt))/sqrt(n())) %>%
  ggplot(aes(day, mean_log_fix_rt))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_log_fix_rt - sem_log_fix_rt, ymax = mean_log_fix_rt + sem_log_fix_rt), width= 0)+
  geom_line()+
  facet_wrap(~subnum)+
  theme(panel.grid = element_blank())+
  labs(x="Day", y = "Mean Log Fixation Cross RT", title = "Y/N Task")+
  scale_x_continuous(breaks=seq(1,11,1))

```
## BC Task

```{r}
bc_fix_rt_data = data_bc_clean %>%
  filter(fmri == 0) %>%
  select(subnum, day, rt, startFix) %>%
  group_by(subnum, day) %>%
  mutate(trialNum = 1:n(),
         startFixDiff = c(diff(startFix), NA), 
         rewardTime = 1.1) %>%
  filter(!is.na(startFixDiff)) %>%
  mutate(fixRt = startFixDiff - (rt+rewardTime))
```

```{r}
summary(bc_fix_rt_data$fixRt)
```

But less than 2% of all trials have fixations RTs slower than 1 second.

```{r}
sum(bc_fix_rt_data$fixRt>1)/nrow(bc_fix_rt_data)
```

Excluding slow fixation RTs for the plot

```{r}
bc_fix_rt_data %>%
  filter(fixRt < 1) %>%
  ggplot(aes(fixRt))+
  geom_histogram(alpha=.5, bins=30)+
  facet_wrap(~subnum)+
  theme(panel.grid = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank())+
  labs(y="", x = "Fixation Cross RT", title = "BC Task")

```

```{r}
bc_fix_rt_data %>%
  filter(fixRt < 1) %>%
  ungroup() %>%
  group_by(subnum, day) %>%
  summarise(.groups="keep",
            mean_log_fix_rt = mean(log(fixRt)),
            sem_log_fix_rt = sd(log(fixRt))/sqrt(n())) %>%
  ggplot(aes(day, mean_log_fix_rt))+
  geom_point()+
  geom_errorbar(aes(ymin=mean_log_fix_rt - sem_log_fix_rt, ymax = mean_log_fix_rt + sem_log_fix_rt), width= 0)+
  geom_line()+
  facet_wrap(~subnum)+
  theme(panel.grid = element_blank())+
  labs(x="Day", y = "Mean Log Fixation Cross RT", title = "BC Task")+
  scale_x_continuous(breaks=seq(1,11,1))

```

# Eye-tracking 

```{r}
data_bc_fix = read.csv(paste0(helpers_path, '/inputs/data_fixBC.csv'))

data_bc_fix = data_bc_fix %>%
  mutate(correct = ifelse(possiblePayoffleft>possiblePayoffright & leftChosen == 1, 1, ifelse(possiblePayoffleft<possiblePayoffright & leftChosen == 0, 1, 0))) %>%
  mutate(type = ifelse(typeLeft == 1, "HT", "RE")) %>%
  mutate(val_diff = possiblePayoffleft - possiblePayoffright,
         val_diff_bin = round(val_diff/50),
         val_diff_bin_str = ifelse(val_diff_bin == 0, "-50:50", 
                                   ifelse(val_diff_bin == 1, "50:100",
                                          ifelse(val_diff_bin == -1, "-100:-50",
                                                 ifelse(val_diff_bin == 2, "100:150",
                                                        ifelse(val_diff_bin == -2, "-150:-100",
                                                               ifelse(val_diff_bin == 3, "150:200",
                                                                      ifelse(val_diff_bin == -3, "-200:-150",
                                                                             ifelse(val_diff_bin == 4, "200:250", 
                                                                                    ifelse(val_diff_bin == -4, "-250:-200", 
                                                                                           ifelse(val_diff_bin == 5, "250:300",
                                                                                                  ifelse(val_diff_bin == -5, "-300:-250", NA))))))))))),
         val_diff_bin_str = factor(val_diff_bin_str, levels = c("-300:-250", "-250:-200", "-200:-150", "-150:-100", "-100:-50", "-50:50", "50:100", "100:150", "150:200", "200:250", "250:300")),
         abs_val_diff_bin_str = ifelse(val_diff_bin == 0, "0:50", 
                                       ifelse(abs(val_diff_bin) == 1, "50:100", 
                                              ifelse(abs(val_diff_bin) == 2, "100:150",
                                                     ifelse(abs(val_diff_bin) == 3, "150:200",
                                                            ifelse(abs(val_diff_bin) == 4, "200:250", 
                                                                   ifelse(abs(val_diff_bin) == 5, "250:300", NA)))))),
         abs_val_diff_bin_str = factor(abs_val_diff_bin_str, levels = c("0:50", "50:100", "100:150", "150:200", "200:250", "250:300")))
```

*Main question: Is hyper-training making a difference in the search process earlier on*

## p(Choice left)

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(lastFix == 1) %>%
  group_by(subnum, day, val_diff_bin_str, leftFix) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(lastFixLeft = ifelse(leftFix == 1, "Left", "Right"),
         day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = lastFixLeft))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = lastFixLeft))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "p(Left Choice)", color="Last Fixation")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByLastFix.jpg'), p, height = 5, width=8, units="in")
p
```

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(lastFix == 1) %>%
  filter(type == "HT") %>%
  group_by(subnum, day, val_diff_bin_str, leftFix) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(lastFixLeft = ifelse(leftFix == 1, "Left", "Right"),
         day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = lastFixLeft))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = lastFixLeft))+
  labs(title = "BC Task - HT stimuli", x = "Value Left - Value Right", y = "p(Left Choice)", color="Last Fixation")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByLastFixHTStim.jpg'), p, height = 5, width=8, units="in")
p
```
```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(lastFix == 1) %>%
  filter(type == "RE") %>%
  group_by(subnum, day, val_diff_bin_str, leftFix) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(lastFixLeft = ifelse(leftFix == 1, "Left", "Right"),
         day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = lastFixLeft))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = lastFixLeft))+
  labs(title = "BC Task - RE stimuli", x = "Value Left - Value Right", y = "p(Left Choice)", color="Last Fixation")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByLastFixREStim.jpg'), p, height = 5, width=8, units="in")
p
```
Fixation advantage 

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  group_by(subnum, day, trialNum) %>%
  summarise(.groups = 'keep',
            totalLeftFix = sum(leftFix),
            totalFix = unique(numTotalFix),
            val_diff_bin_str = unique(val_diff_bin_str),
            leftChosen = unique(leftChosen)) %>%
  mutate(fixAdv = ifelse( (totalLeftFix / totalFix) > .5, "Left", "Right")) %>%
  ungroup() %>%
  group_by(subnum, day, val_diff_bin_str, fixAdv) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = fixAdv))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = fixAdv))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "p(Left Choice)", color="Fixation Advantage")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByFixAdv.jpg'), p, height = 5, width=8, units="in")
p
```

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(type == "HT") %>%
  group_by(subnum, day, trialNum) %>%
  summarise(.groups = 'keep',
            totalLeftFix = sum(leftFix),
            totalFix = unique(numTotalFix),
            val_diff_bin_str = unique(val_diff_bin_str),
            leftChosen = unique(leftChosen)) %>%
  mutate(fixAdv = ifelse( (totalLeftFix / totalFix) > .5, "Left", "Right")) %>%
  ungroup() %>%
  group_by(subnum, day, val_diff_bin_str, fixAdv) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = fixAdv))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = fixAdv))+
  labs(title = "BC Task - HT stimuli", x = "Value Left - Value Right", y = "p(Left Choice)", color="Fixation Advantage")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByFixAdvHTStim.jpg'), p, height = 5, width=8, units="in")
p
```
```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(type == "RE") %>%
  group_by(subnum, day, trialNum) %>%
  summarise(.groups = 'keep',
            totalLeftFix = sum(leftFix),
            totalFix = unique(numTotalFix),
            val_diff_bin_str = unique(val_diff_bin_str),
            leftChosen = unique(leftChosen)) %>%
  mutate(fixAdv = ifelse( (totalLeftFix / totalFix) > .5, "Left", "Right")) %>%
  ungroup() %>%
  group_by(subnum, day, val_diff_bin_str, fixAdv) %>%
  summarise(.groups = 'keep',
            mean_left_choice = mean(leftChosen),
            sem_left_choice = sd(leftChosen)/sqrt(n())) %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_left_choice, color = fixAdv))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_left_choice - sem_left_choice, ymax = mean_left_choice + sem_left_choice), width = 0)+
  geom_line(aes(group = fixAdv))+
  labs(title = "BC Task - HT stimuli", x = "Value Left - Value Right", y = "p(Left Choice)", color="Fixation Advantage")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Set1")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pLeftOverValDiffByFixAdvREStim.jpg'), p, height = 5, width=8, units="in")
p
```

## p(First Fix == Left)

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(firstFix == 1) %>%
  group_by(subnum, day, type, val_diff_bin_str) %>%
  summarise(mean_first_fix_left = mean(leftFix),
            sem_first_fix_left = sd(leftFix)/sqrt(n()), .groups="keep") %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11"))) %>%
  ggplot(aes(val_diff_bin_str, mean_first_fix_left, color = type))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_first_fix_left - sem_first_fix_left, ymax = mean_first_fix_left + sem_first_fix_left), width = 0)+
  geom_line(aes(group = type))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "p(First Fixation == Left)", color="")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pFirstFixLeftOverValDiff.jpg'), p, height = 5, width=8, units="in")
p
```

## p(First Fix == Best)

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(firstFix == 1) %>%
  mutate(firstFixToBest = ifelse(leftFix == 1 & val_diff > 0, 1, ifelse(leftFix == 0 & val_diff < 0, 1, 0))) %>%
  group_by(subnum, day, type, val_diff_bin_str) %>%
  summarise(mean_first_fix_best = mean(firstFixToBest),
            sem_first_fix_best = sd(firstFixToBest)/sqrt(n()), .groups="keep") %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11")))%>%
  ggplot(aes(val_diff_bin_str, mean_first_fix_best, color = type))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_first_fix_best - sem_first_fix_best, ymax = mean_first_fix_best + sem_first_fix_best), width = 0)+
  geom_line(aes(group = type))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "p(First Fixation == Better Option)", color="")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))+
  scale_y_continuous(breaks = seq(0,1,.5))

ggsave(file=paste0(fig_out_path, 'bc_pFirstFixBestOverValDiff.jpg'), p, height = 5, width=8, units="in")
p
```
## Mean number of fixations

```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(lastFix == 1) %>%
  group_by(subnum, day, type, val_diff_bin_str) %>%
  summarise(mean_num_fix = mean(numTotalFix),
            sem_num_fix = sd(numTotalFix)/sqrt(n()), .groups="keep") %>%
  mutate(day = paste0("Day ", day),
         day = factor(day, levels = c("Day 3", "Day 7", "Day 11")))%>%
  ggplot(aes(val_diff_bin_str, mean_num_fix, color = type))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_num_fix - sem_num_fix, ymax = mean_num_fix + sem_num_fix), width = 0)+
  geom_line(aes(group = type))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "Mean Number of Fixations", color="")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day, scales = 'free_y')+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))

ggsave(file=paste0(fig_out_path, 'bc_meanNumFixOverValDiff.jpg'), p, height = 5, width=8, units="in")
p
```
```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  filter(lastFix == 1) %>%
  group_by(subnum, day, type) %>%
  summarise(mean_num_fix = mean(numTotalFix),
            sem_num_fix = sd(numTotalFix)/sqrt(n()), .groups="keep") %>%
  ggplot(aes(day, mean_num_fix, color = type))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_num_fix - sem_num_fix, ymax = mean_num_fix + sem_num_fix), width = 0)+
  geom_line(aes(group = type))+
  labs(title = "BC Task", x = "Day", y = "Mean Number of Fixations", color="")+
  facet_wrap(~subnum)+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_continuous(breaks = c(3, 7, 11))

ggsave(file=paste0(fig_out_path, 'bc_meanNumFixOverDays.jpg'), p, height = 5, width=8, units="in")
p
```

y: relative fixation time
x: relative value difference
color: HT vs RE



```{r}
p = data_bc_fix %>%
  filter(!is.na(val_diff_bin_str)) %>%
  group_by(subnum, day, type, trialNum, leftFix, val_diff_bin_str) %>%
  summarise(.groups = "keep",
            totalFixDuration = sum(fixDuration)) %>%
  mutate(leftFix = ifelse(leftFix == 1, "LeftDur", "RightDur")) %>%
  spread(leftFix, totalFixDuration) %>%
  mutate(LeftDur = ifelse(is.na(LeftDur), 0, LeftDur),
         RightDur = ifelse(is.na(RightDur), 0, RightDur),
         propLeftFixDur = LeftDur/ (RightDur+LeftDur)) %>%
  ungroup() %>%
  group_by(subnum, day, type, val_diff_bin_str) %>%
  summarise(.groups = "keep",
            mean_propLeftFixDur = mean(propLeftFixDur),
            sem_propLeftFixDur = sd(propLeftFixDur)/sqrt(n())) %>%
  ggplot(aes(val_diff_bin_str, mean_propLeftFixDur, color = type))+
  geom_point()+
  geom_errorbar(aes(ymin = mean_propLeftFixDur - sem_propLeftFixDur, ymax = mean_propLeftFixDur + sem_propLeftFixDur), width = 0)+
  geom_line(aes(group = type))+
  labs(title = "BC Task", x = "Value Left - Value Right", y = "Proportion of Left Fixation Duration", color="")+
  geom_hline(aes(yintercept=.5), color="gray", linetype = "longdash")+
  geom_vline(aes(xintercept=6), color="gray", linetype = "longdash")+
  facet_grid(subnum ~ day, scales = 'free_y')+
  theme(panel.grid = element_blank(),
        legend.position = "bottom",
        axis.text.x = element_text(angle = 15, margin = margin(t = 5)),
        legend.box.margin=margin(t = -10))+
  scale_color_brewer(palette = "Dark2")+
  scale_x_discrete(labels=c("", "-250:-200", "", "-150:-100", "", "-50:50", "", "100:150", "", "200:250", ""))

ggsave(file=paste0(fig_out_path, 'bc_propLeftFixDurOverValDiff.jpg'), p, height = 5, width=8, units="in")
p
```

