---
title: "Novel vs. repeated choice project: Behavioral Modeling"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: 'hide'
---

# Set up environment and load in data

```{r include=FALSE, message=FALSE}
library(tidyverse)
library(brms)
library(here)
theme_set(theme_bw())
helpers_path = paste0(here(),'/analysis/helpers/')
source(paste0(helpers_path, '01_clean_behavioral_data.R'))
fig_out_path = paste0(here(), '/outputs/fig/')
```

Add columns that will be used for plots below.

```{r}
data_yn_clean = data_yn_clean %>%
  mutate(correct = ifelse(possiblePayoff>reference & yesChosen == 1, 1, ifelse(possiblePayoff < reference & yesChosen == 0, 1, 0))) %>%
  mutate(type = ifelse(type == 1, "HT", "RE"),
         week = ifelse(week == 1, "Week 1", ifelse(week == 2, "Week 2", ifelse(week == 3, "Week 3", NA))),
         week = factor(week, levels = c("Week 1", "Week 2", "Week 3"))) %>%
  mutate(val_diff = possiblePayoff - reference,
         val_diff_bin = round(val_diff/50),
         val_diff_bin_str = paste0(val_diff_bin*50-25,":",val_diff_bin*50+25),
         val_diff_bin_str = factor(val_diff_bin_str, levels = c("-225:-175", "-175:-125", "-125:-75", "-75:-25", "-25:25", "25:75", "75:125", "125:175", "175:225")))

data_bc_clean = data_bc_clean %>%
  mutate(correct = ifelse(possiblePayoffleft>possiblePayoffright & leftChosen == 1, 1, ifelse(possiblePayoffleft<possiblePayoffright & leftChosen == 0, 1, 0))) %>%
  mutate(type = ifelse(typeLeft == 1, "HT", "RE"),
         week = ifelse(week == 1, "Week 1", ifelse(week == 2, "Week 2", ifelse(week == 3, "Week 3", NA))),
         week = factor(week, levels = c("Week 1", "Week 2", "Week 3"))) %>%
  mutate(val_diff = possiblePayoffleft - possiblePayoffright,
         val_diff_bin = round(val_diff/50),
         val_diff_bin_str = paste0(val_diff_bin*50-25,":",val_diff_bin*50+25),
         val_diff_bin_str = factor(val_diff_bin_str, levels = c("-275:-225","-225:-175", "-175:-125", "-125:-75", "-75:-25", "-25:25", "25:75", "75:125", "125:175", "175:225", "225:275"))) %>%
  filter(!is.na(val_diff_bin_str))
```

# Logits for choice in Y/N and BC

## YN task

Does the logit slope change across days? (value_diff:day interaction)
Is the logit slope different depending on the stim type? (value_diff:type interaction)
Does it change differently depending on the stim type? (value_diff:day:type interaction)

**Center variables!**
The brms output is huge. Extract only what you need from it to make the following plots!

```{r}
# yn_logit <- brm(formula = yesChosen ~ val_diff * day * type + (1|subnum),  
#                    data= data_yn_clean, 
#                    family = bernoulli(link = "logit"),
#                    warmup = 500, 
#                    iter = 2500, 
#                    chains = 4, 
#                    init = "0", 
#                    cores=4,
#                    seed = 3253)

yn_logit <- brm(formula = yesChosen ~ val_diff * day * type,
                   data= data_yn_clean %>% filter(subnum == "601"),
                   family = bernoulli(link = "logit"),
                   warmup = 500,
                   iter = 2500,
                   chains = 4,
                   init = "0",
                   cores = 4,
                   seed = 389253)
```

Examine chains

```{r}
mcmc_plot(yn_logit, type = "trace")
```

Examine autocorrelation in 

```{r}
mcmc_plot(yn_logit, type = "acf_bar")
```

Examine parameter distributions

```{r}
mcmc_plot(yn_logit, type = "areas", prob = 0.95)
```

Plot predicted plots on top of observed data

```{r}

```

## BC task

```{r}
leftChosen ~ value_diff * day * type + (1|subnum)
```

# RT slope for YN and BC

```{r}

```

# DDM for YN

```{r}

```

# aDDM for BC

```{r}

```
